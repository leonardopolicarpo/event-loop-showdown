<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Event Loop Showdown</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 2rem; }
        .container { max-width: 800px; margin: auto; }
        h1 { color: #bb86fc; }
        .buttons { margin-bottom: 1.5rem; display: flex; gap: 1rem; justify-content: center }
        button { background-color: #bb86fc; color: #121212; border: none; padding: 10px 20px; font-size: 1rem; cursor: pointer; border-radius: 4px; transition: background-color 0.2s; }
        button:hover { background-color: #a36cf7; }
        button:disabled { background-color: #555; cursor: not-allowed; }
        #log { background-color: #1e1e1e; border: 1px solid #333; height: 400px; overflow-y: scroll; padding: 1rem; border-radius: 4px; font-family: "Courier New", Courier, monospace; white-space: pre-wrap; }
        .pong { color: #03dac6; }
        .info { color: #cf6679; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Node.js Event Loop Showdown</h1>
        <p>A API envia um "pong" a cada segundo. Clique nos botões para disparar uma tarefa pesada de CPU e veja o que acontece com o fluxo de "pongs".</p>
        <div class="buttons">
            <button id="btnBlocking">Iniciar Teste Bloqueante</button>
            <button id="btnNonBlocking">Iniciar Teste Não-Bloqueante</button>
        </div>
        <pre id="log"></pre>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const log = document.getElementById('log');
        const btnBlocking = document.getElementById('btnBlocking');
        const btnNonBlocking = document.getElementById('btnNonBlocking');
        const socket = io();

        function addLog(message, className = '') {
            const line = document.createElement('div');
            line.className = className;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
        }

        socket.on('ping', (message) => {
            addLog(message, 'pong');
        });

        async function runTest(path) {
            btnBlocking.disabled = true;
            btnNonBlocking.disabled = true;
            addLog(`Disparando requisição para ${path}...`, 'info');
            
            try {
                const response = await fetch(path);
                const text = await response.text();
                addLog(`Resposta de ${path}: ${text}`, 'info');
            } catch (error) {
                addLog(`Erro ao chamar ${path}: ${error.message}`, 'info');
            } finally {
                btnBlocking.disabled = false;
                btnNonBlocking.disabled = false;
            }
        }

        btnBlocking.addEventListener('click', () => runTest('/blocking'));
        btnNonBlocking.addEventListener('click', () => runTest('/non-blocking'));
    </script>
</body>
</html>
